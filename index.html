<body>
  <div class="wrap">
    <h1>GameCre8 — Prompt → Play (Demo)</h1>
    <form id="f">
      <label for="p">Your game idea:</label><br />
      <input id="p" name="p"
             placeholder="Unicorn jumping cloud to cloud…"
             required
             style="width:100%;padding:10px;margin:8px 0;border:1px solid #ccc;border-radius:8px"/>
      <button type="submit"
              style="padding:10px 16px;border:0;border-radius:8px;cursor:pointer">
        Generate
      </button>
    </form>

    <div id="status" style="margin-top:10px;color:#555"></div>

    <h3>Result</h3>
    <pre id="out"></pre>

    <h3>Share link</h3>
    <p id="share"></p>
  </div>

  <script>
    const form = document.getElementById("f");
    const statusEl = document.getElementById("status");
    const outEl = document.getElementById("out");
    const shareEl = document.getElementById("share");

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      shareEl.textContent = "";
      outEl.textContent = "";
      statusEl.textContent = "Generating…";

      const prompt = document.getElementById("p").value.trim();

      try {
        // 1) Generate
        const genRes = await fetch("/api/generatr", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ prompt })
        });
        const game = await genRes.json();
        if (!genRes.ok) throw new Error(game.error || "Generation failed");

        outEl.textContent = JSON.stringify(game, null, 2);

        // 2) Save (auto)
        statusEl.textContent = "Saving…";
        const saveRes = await fetch("/api/save-game", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ prompt, game })
        });
        const saved = await saveRes.json();
        if (!saveRes.ok) throw new Error(saved.error || "Save failed");

        statusEl.textContent = "Done!";
        shareEl.innerHTML = `<a href="${saved.share_url}" target="_blank" rel="noopener">Open your game</a>`;
      } catch (err) {
        statusEl.textContent = "Error: " + err.message;
      }
    });
  </script>
</body>
